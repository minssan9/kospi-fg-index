# Log rotation configuration for Fear & Greed Index Production
# Place this file in /etc/logrotate.d/ or use it with custom logrotate container

# Application Logs
/logs/backend/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 0644 fg-app fg-app
    sharedscripts
    postrotate
        # Send SIGUSR1 to Node.js process to reopen log files
        docker exec fg-backend-prod pkill -USR1 node || true
    endscript
}

/logs/scheduler/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 0644 fg-app fg-app
    sharedscripts
    postrotate
        docker exec fg-scheduler-prod pkill -USR1 node || true
    endscript
}

# Nginx Logs
/logs/nginx/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 0644 nginx nginx
    sharedscripts
    postrotate
        # Reload nginx to reopen log files
        docker exec fg-nginx-prod nginx -s reload || true
    endscript
}

# PostgreSQL Logs
/logs/postgres/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 0644 postgres postgres
    sharedscripts
    postrotate
        # PostgreSQL automatically handles log file rotation
        docker exec fg-database-prod pg_ctl reload || true
    endscript
}

# Redis Logs
/logs/redis/*.log {
    weekly
    missingok
    rotate 8
    compress
    delaycompress
    notifempty
    create 0644 redis redis
    sharedscripts
    postrotate
        # Redis handles log rotation internally
        docker exec fg-redis-prod redis-cli CONFIG REWRITE || true
    endscript
}

# System and Deployment Logs
/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 0644 fg-app fg-app
}

# Error Logs - Keep longer for debugging
/logs/**/*error*.log {
    daily
    missingok
    rotate 60
    compress
    delaycompress
    notifempty
    create 0644 fg-app fg-app
}

# Access Logs - Rotate more frequently due to size
/logs/**/access*.log {
    daily
    missingok
    rotate 14
    compress
    delaycompress
    notifempty
    create 0644 fg-app fg-app
}

# Monitor Logs
/logs/monitor.log {
    weekly
    missingok
    rotate 12
    compress
    delaycompress
    notifempty
    create 0644 fg-app fg-app
}

# Deploy Logs
/logs/deploy.log {
    monthly
    missingok
    rotate 12
    compress
    delaycompress
    notifempty
    create 0644 fg-app fg-app
}